<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Study Mode</title>
    <style>
        body { font-family: sans-serif; text-align: center; }
        .card-display { width: 500px; height: 250px; margin: 30px auto; border: 2px solid #333; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; background: white; }
    </style>
</head>
<body>
    <h1 th:text="${flashcardSet.title}">Set Title</h1>

    <div class="card-display" id="card-content">
        Front
    </div>

    <div style="margin-top: 20px;">
        <button onclick="prevCard()">Previous</button>
        <span id="counter" style="margin: 0 15px";>1 / 1</span>
        <button onclick="nextCard()">Next</button>
        <button onclick="shuffleDeck()">Shuffle</button>
    </div>

    <div style="margin-top: 20px;">
        <button onclick="markResult(true)">✔️</button>
        <button onclick="markResult(false)">❌</button>
    </div>

    <a th:href="@{/sets/{id}(id=${flashcardSet.id})}">Back to Set</a>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const cards = /*[[${flashcardSet.cards}]]*/ [];

        let currentIndex = 0;
        let isShowingFront = true;

        const cardContent = document.getElementById('card-content');

        function showCard() {
            if (cards.length > 0) {
                isShowingFront = true;
                cardContent.textContent = cards[currentIndex].front;
            } else {
                cardContent.textContent = "No cards in this set!";
            }
        }

        cardContent.addEventListener('click', function() {
            if (cards.length == 0) return;

            if (isShowingFront) {
                cardContent.textContent = cards[currentIndex].back;
                isShowingFront = false;
            } else {
                cardContent.textContent = cards[currentIndex].front;
                isShowingFront = true;
            }
        });

        const counterElement = document.getElementById('counter');

        function updateCounter() {
            if (cards.length > 0) {
                counterElement.textContent = (currentIndex + 1) + " / " + cards.length;
            } else {
                counterElement.textContent = "0 / 0";
            }

        }

        function nextCard() {
            if (currentIndex < cards.length - 1) {
                currentIndex++;
                showCard();
                updateCounter();
            }
        }

        function prevCard() {
            if (currentIndex > 0) {
                currentIndex--;
                showCard();
                updateCounter();
            }
        }

        let wrongCards = [];

        function markResult(isCorrect) {
            if (!isCorrect) {
                wrongCards.push(cards[currentIndex]);
            }

            if (currentIndex < cards.length - 1) {
                nextCard();
            } else {
                showSummary();
            }
        }

        function showSummary() {
            const cardDisplay = document.getElementById('card-content');

            cardDisplay.innerHTML = `
                <div style="text-align:center">
                    <h3>Session Complete!</h3>
                    <p>You got ${wrongCards.length} wrong out of ${cards.length}.</p>
                    ${wrongCards.length > 0 ? '<button onclick="reviewWrong()">Review Wrong Cards</button>' : ''}
                    <button onclick="location.reload()">Restart All</button>
                </div>
            `;
        }

        function reviewWrong() {
            if (wrongCards.length > 0) {
                cards.length = 0;
                cards.push(...wrongCards);

                wrongCards = [];

                currentIndex = 0;
                showCard();
                updateCounter();
            }
        }

        function shuffleDeck() {
            if (cards.length == 0) return;

            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }

            currentIndex = 0;
            showCard();
            updateCounter();
        }

        showCard();
        updateCounter();
        /*]]>*/
    </script>

</body>
</html>